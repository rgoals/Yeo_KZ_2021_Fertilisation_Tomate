[["le-rendement-tomate.html", "Chapitre 7 Le rendement tomate 7.1 Préparation des données 7.2 Visualisation, boxplots 7.3 Identification des échantillons aberrants extrêmes", " Chapitre 7 Le rendement tomate 7.1 Préparation des données Jeu de données rdt.csv qui contient également les mesures des masses des tomates récoltées à la fin de culture. Le rendement est calculé pour les 4 plants centraux et cumule les 3 séances de récolte. rdt_tha : 116 JAS, 82 JAR, semaine 12 AR. La question est de savoir si les différents types dengrais induisent des rendements fruits significativement différents. df &lt;- read_csv(&quot;data/rdt.csv&quot;) ## ## -- Column specification -------------------------------------------------------- ## cols( ## bloc = col_double(), ## traitement = col_character(), ## engrais = col_character(), ## fleur1 = col_double(), ## fruit1 = col_double(), ## fleur2 = col_double(), ## fruit2 = col_double(), ## fleur3 = col_double(), ## fruit3 = col_double(), ## taux_fruit = col_double(), ## nfruits_re_m2 = col_double(), ## taux_nou_5 = col_double(), ## taux_nou_6 = col_double(), ## taux_nou_7 = col_double(), ## rdt_kgha = col_double(), ## rdt_tha = col_double() ## ) df &lt;- df %&gt;% mutate(id = 1:nrow(.), before = 1) %&gt;% select(id, bloc, traitement, engrais, rdt_tha) %&gt;% convert_as_factor(traitement, engrais) df$engrais &lt;- factor(df$engrais, levels = c(&quot;Temoin&quot;, &quot;Fumier porcs&quot;, &quot;Fumier poulets&quot;, &quot;Engrais mineral&quot;, &quot;50% FPorcs + 50% Eng. Min.&quot;, &quot;50% FPoulets + 50% Eng. Min.&quot;)) write_csv(df, &quot;tab/rdt_tha.csv&quot;) set.seed(123) df %&gt;% sample_n_by(bloc, size = 1) ## # A tibble: 5 x 5 ## id bloc traitement engrais rdt_tha ## &lt;int&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; ## 1 3 1 T2 Fumier poulets 1.69 ## 2 12 2 T5 50% FPoulets + 50% Eng. Min. 1.57 ## 3 15 3 T2 Fumier poulets 0.78 ## 4 20 4 T1 Fumier porcs 0.64 ## 5 26 5 T1 Fumier porcs 0.48 7.2 Visualisation, boxplots bxp &lt;- ggplot(df, aes(x = engrais, y = rdt_tha)) + geom_boxplot() + theme_bw() + xlab(&quot;Engrais&quot;) + ylab(&quot;Rendement t/ha&quot;) + theme(axis.text.x = element_text(angle = 45, color = &quot;black&quot;, vjust = 1, hjust = 1)) bxp 7.3 Identification des échantillons aberrants extrêmes df_out &lt;- df %&gt;% group_by(engrais) %&gt;% identify_outliers(rdt_tha) %&gt;% select(id, engrais, bloc, rdt_tha, is.outlier, is.extreme) df_out ## # A tibble: 3 x 6 ## id engrais bloc rdt_tha is.outlier is.extreme ## &lt;int&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt; ## 1 10 Engrais mineral 2 0.26 TRUE TRUE ## 2 29 50% FPorcs + 50% Eng. Min. 5 0.41 TRUE FALSE ## 3 18 50% FPoulets + 50% Eng. Min. 3 3.06 TRUE TRUE Il y a 2 observations aberrantes extrêmes mais qui ne sont pas exclues. #df &lt;- df %&gt;% filter(! id %in% c(10, 18)) 7.3.1 Le modèle ANOVA lm &lt;- lm(rdt_tha ~ engrais, data = df) Anova(lm) ## Anova Table (Type II tests) ## ## Response: rdt_tha ## Sum Sq Df F value Pr(&gt;F) ## engrais 3.3005 5 3.0729 0.02776 * ## Residuals 5.1555 24 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Il y aurait une différence significative entre les effets dau moins 2 engrais sur le rendement tomate. Mais vérifions les conditions de validité de lANOVA. 7.3.2 Indépendance des résidus plot(lm, 1) 7.3.3 Normalité des résidus plot(lm, 2) shapiro_test(rdt_tha, data = df) ## # A tibble: 1 x 3 ## variable statistic p ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 rdt_tha 0.846 0.000510 7.3.4 Homogénéité des variances plot(lm, 3) levene_test(residuals(lm) ~ engrais, data = df) ## # A tibble: 1 x 4 ## df1 df2 statistic p ## &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 5 24 0.528 0.753 On retient que la conclusion de lANOVA peut être considérée valide : =&gt; différence deffet sur le rendement entre au moins deux engrais. df %&gt;% kruskal_test(rdt_tha ~ engrais) ## # A tibble: 1 x 6 ## .y. n statistic df p method ## * &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 rdt_tha 30 11.8 5 0.0382 Kruskal-Wallis df %&gt;% dunn_test(rdt_tha ~ engrais, p.adjust.method = &quot;bonferroni&quot;) %&gt;% select(group1, group2, p, p.adj, p.adj.signif) #%&gt;% ## # A tibble: 15 x 5 ## group1 group2 p p.adj p.adj.signif ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 Temoin Fumier porcs 0.914 1 ns ## 2 Temoin Fumier poulets 0.172 1 ns ## 3 Temoin Engrais mineral 1 1 ns ## 4 Temoin 50% FPorcs + 50% Eng. M~ 0.236 1 ns ## 5 Temoin 50% FPoulets + 50% Eng.~ 0.00874 0.131 ns ## 6 Fumier porcs Fumier poulets 0.141 1 ns ## 7 Fumier porcs Engrais mineral 0.914 1 ns ## 8 Fumier porcs 50% FPorcs + 50% Eng. M~ 0.196 1 ns ## 9 Fumier porcs 50% FPoulets + 50% Eng.~ 0.00633 0.0950 ns ## 10 Fumier poulets Engrais mineral 0.172 1 ns ## 11 Fumier poulets 50% FPorcs + 50% Eng. M~ 0.857 1 ns ## 12 Fumier poulets 50% FPoulets + 50% Eng.~ 0.209 1 ns ## 13 Engrais mineral 50% FPorcs + 50% Eng. M~ 0.236 1 ns ## 14 Engrais mineral 50% FPoulets + 50% Eng.~ 0.00874 0.131 ns ## 15 50% FPorcs + 50% Eng. M~ 50% FPoulets + 50% Eng.~ 0.151 1 ns #filter(p.adj.signif != &quot;ns&quot;) 7.3.5 Comparaisons par paires Tests post-hoc de multiples comparaisons par paires entre les groupes (ici, les engrais). tb_mc &lt;- (SNK.test(lm, &quot;engrais&quot;, group = TRUE))$groups %&gt;% mutate(engrais = rownames(.)) %&gt;% select(engrais, rdt_tha, groups) %&gt;% as_tibble() tb_mc ## # A tibble: 6 x 3 ## engrais rdt_tha groups ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 50% FPoulets + 50% Eng. Min. 1.62 a ## 2 Fumier poulets 1.14 ab ## 3 50% FPorcs + 50% Eng. Min. 0.948 ab ## 4 Engrais mineral 0.742 b ## 5 Fumier porcs 0.714 b ## 6 Temoin 0.672 b cm &lt;- multcomp::glht(lm, linfct = multcomp::mcp(engrais = &quot;Tukey&quot;)) summary(cm) ## ## Simultaneous Tests for General Linear Hypotheses ## ## Multiple Comparisons of Means: Tukey Contrasts ## ## ## Fit: lm(formula = rdt_tha ~ engrais, data = df) ## ## Linear Hypotheses: ## Estimate ## Fumier porcs - Temoin == 0 0.0420 ## Fumier poulets - Temoin == 0 0.4660 ## Engrais mineral - Temoin == 0 0.0700 ## 50% FPorcs + 50% Eng. Min. - Temoin == 0 0.2760 ## 50% FPoulets + 50% Eng. Min. - Temoin == 0 0.9500 ## Fumier poulets - Fumier porcs == 0 0.4240 ## Engrais mineral - Fumier porcs == 0 0.0280 ## 50% FPorcs + 50% Eng. Min. - Fumier porcs == 0 0.2340 ## 50% FPoulets + 50% Eng. Min. - Fumier porcs == 0 0.9080 ## Engrais mineral - Fumier poulets == 0 -0.3960 ## 50% FPorcs + 50% Eng. Min. - Fumier poulets == 0 -0.1900 ## 50% FPoulets + 50% Eng. Min. - Fumier poulets == 0 0.4840 ## 50% FPorcs + 50% Eng. Min. - Engrais mineral == 0 0.2060 ## 50% FPoulets + 50% Eng. Min. - Engrais mineral == 0 0.8800 ## 50% FPoulets + 50% Eng. Min. - 50% FPorcs + 50% Eng. Min. == 0 0.6740 ## Std. Error ## Fumier porcs - Temoin == 0 0.2931 ## Fumier poulets - Temoin == 0 0.2931 ## Engrais mineral - Temoin == 0 0.2931 ## 50% FPorcs + 50% Eng. Min. - Temoin == 0 0.2931 ## 50% FPoulets + 50% Eng. Min. - Temoin == 0 0.2931 ## Fumier poulets - Fumier porcs == 0 0.2931 ## Engrais mineral - Fumier porcs == 0 0.2931 ## 50% FPorcs + 50% Eng. Min. - Fumier porcs == 0 0.2931 ## 50% FPoulets + 50% Eng. Min. - Fumier porcs == 0 0.2931 ## Engrais mineral - Fumier poulets == 0 0.2931 ## 50% FPorcs + 50% Eng. Min. - Fumier poulets == 0 0.2931 ## 50% FPoulets + 50% Eng. Min. - Fumier poulets == 0 0.2931 ## 50% FPorcs + 50% Eng. Min. - Engrais mineral == 0 0.2931 ## 50% FPoulets + 50% Eng. Min. - Engrais mineral == 0 0.2931 ## 50% FPoulets + 50% Eng. Min. - 50% FPorcs + 50% Eng. Min. == 0 0.2931 ## t value Pr(&gt;|t|) ## Fumier porcs - Temoin == 0 0.143 1.0000 ## Fumier poulets - Temoin == 0 1.590 0.6127 ## Engrais mineral - Temoin == 0 0.239 0.9999 ## 50% FPorcs + 50% Eng. Min. - Temoin == 0 0.942 0.9315 ## 50% FPoulets + 50% Eng. Min. - Temoin == 0 3.241 0.0361 ## Fumier poulets - Fumier porcs == 0 1.446 0.6995 ## Engrais mineral - Fumier porcs == 0 0.096 1.0000 ## 50% FPorcs + 50% Eng. Min. - Fumier porcs == 0 0.798 0.9651 ## 50% FPoulets + 50% Eng. Min. - Fumier porcs == 0 3.098 0.0492 ## Engrais mineral - Fumier poulets == 0 -1.351 0.7545 ## 50% FPorcs + 50% Eng. Min. - Fumier poulets == 0 -0.648 0.9859 ## 50% FPoulets + 50% Eng. Min. - Fumier poulets == 0 1.651 0.5749 ## 50% FPorcs + 50% Eng. Min. - Engrais mineral == 0 0.703 0.9798 ## 50% FPoulets + 50% Eng. Min. - Engrais mineral == 0 3.002 0.0606 ## 50% FPoulets + 50% Eng. Min. - 50% FPorcs + 50% Eng. Min. == 0 2.299 0.2331 ## ## Fumier porcs - Temoin == 0 ## Fumier poulets - Temoin == 0 ## Engrais mineral - Temoin == 0 ## 50% FPorcs + 50% Eng. Min. - Temoin == 0 ## 50% FPoulets + 50% Eng. Min. - Temoin == 0 * ## Fumier poulets - Fumier porcs == 0 ## Engrais mineral - Fumier porcs == 0 ## 50% FPorcs + 50% Eng. Min. - Fumier porcs == 0 ## 50% FPoulets + 50% Eng. Min. - Fumier porcs == 0 * ## Engrais mineral - Fumier poulets == 0 ## 50% FPorcs + 50% Eng. Min. - Fumier poulets == 0 ## 50% FPoulets + 50% Eng. Min. - Fumier poulets == 0 ## 50% FPorcs + 50% Eng. Min. - Engrais mineral == 0 ## 50% FPoulets + 50% Eng. Min. - Engrais mineral == 0 . ## 50% FPoulets + 50% Eng. Min. - 50% FPorcs + 50% Eng. Min. == 0 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## (Adjusted p values reported -- single-step method) 7.3.6 Graphe des comparaisons par(mar = c(0, 22, 0, 0)) plot(cm) 7.3.7 Lettres pour différencier cld &lt;- multcomp::cld(cm) cld ## Temoin Fumier porcs ## &quot;a&quot; &quot;a&quot; ## Fumier poulets Engrais mineral ## &quot;ab&quot; &quot;ab&quot; ## 50% FPorcs + 50% Eng. Min. 50% FPoulets + 50% Eng. Min. ## &quot;ab&quot; &quot;b&quot; 7.3.8 Les lettres dans un dataframe pour ggplot Le &lt;- cld$mcletters$Letters L &lt;- data.frame(engrais = levels(df$engrais), lettres = Le) L ## engrais lettres ## Temoin Temoin a ## Fumier porcs Fumier porcs a ## Fumier poulets Fumier poulets ab ## Engrais mineral Engrais mineral ab ## 50% FPorcs + 50% Eng. Min. 50% FPorcs + 50% Eng. Min. ab ## 50% FPoulets + 50% Eng. Min. 50% FPoulets + 50% Eng. Min. b 7.3.9 Associer les moyennes et les écart-types pour le rapport rdt_moy &lt;- df %&gt;% group_by(engrais) %&gt;% get_summary_stats(rdt_tha, type = &quot;mean_sd&quot;) %&gt;% select(-variable) %&gt;% mutate(lettres = L$lettres) write_csv(rdt_moy, &quot;tab/rend_moyennes.csv&quot;) rdt_moy ## # A tibble: 6 x 5 ## engrais n mean sd lettres ## &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; ## 1 Temoin 5 0.672 0.429 a ## 2 Fumier porcs 5 0.714 0.211 a ## 3 Fumier poulets 5 1.14 0.424 ab ## 4 Engrais mineral 5 0.742 0.297 ab ## 5 50% FPorcs + 50% Eng. Min. 5 0.948 0.33 ab ## 6 50% FPoulets + 50% Eng. Min. 5 1.62 0.827 b 7.3.10 Graphe avec les comparaisons ggplot(rdt_moy, aes(x = engrais, y = mean)) + geom_bar(stat = &quot;identity&quot;, color = &quot;blue&quot;, fill = &quot;grey&quot;, width = 0.6) + ylim(0, 2) + theme_bw() + xlab(&quot;Engrais&quot;) + ylab(&quot;Rendement t/ha&quot;) + theme(axis.text.x = element_text(angle = 45, color = &quot;black&quot;, vjust = 1, hjust = 1)) + geom_text(aes(label = lettres), vjust = -0.5, size = 4) "]]
